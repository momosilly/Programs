<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Movie suggester</title>
        <link rel="stylesheet" href="{{url_for('static', filename='style.css')}}">
    </head>
    <body>
        <div id="main">
        <h2>Movie suggester</h2>
        <form action="/filters" method="post">
                <label for="mood">Choose your mood:</label>
                <select name="mood" id="mood" required>
                    <option value="" disabled selected>Select a mood</option>
                    <option value="happy">Happy</option>
                    <option value="sad">Sad</option>
                    <option value="adventurous">Adventurous</option>
                    <option value="curious">Curious</option>
                    <option value="thoughtful">Thoughtful</option>
                    <option value="nostalgic">Nostalgic</option>
                    <option value="energetic">Energetic</option>
                    <option value="romantic">Romantic</option>
                    <option value="scared">Scared</option>
                    <option value="escapist">Escapist</option>
                    <option value="reflective">Reflective</option>
                    <option value="lighthearted">Lighthearted</option>
                    <option value="dark">Dark</option>
                </select>
                <div class="input-group">
                    <input type="text" name="language" class="inputs langin" placeholder="" required>
                    <label for="" class="labels  lang">What's your preffered language</label>
                </div>
                <div class="input-group">
                    <input type="text" name="actor" class="inputs actorin" placeholder="">
                    <label for="" class="labels  actor">Who's your favorite actor? <span>(optional)</span></label>
                </div>
                <div class="input-group">
                    <input type="number" name="year" class="inputs yearin" placeholder="">
                    <label for="" class="labels  year">What's your preffered release year <span>(optional)</span></label>
                </div>
                <div class="input-group">
                    <input type="number" name="rating" class="inputs ratingin" step="0.1" min="0" max="10" placeholder="">
                    <label for="" class="labels  rating">What's the preffered minimum rating <span>(optional)</span></label>
                </div>
                <input type="hidden" name="page" id="page" value="{{ page }}">
                <br>
                <label for="type">Choose a movie type:</label>
             <select name="type" id="type">
                <option value="" disabled selected>Select a type</option>
                <option value="animation">Animation</option>
                <option value="documentary">Documentary</option>
                <option value="sci-fi">Sci-Fi</option>
                <option value="fantasy">Fantasy</option>
                <option value="tv movie">TV Movie</option>
                <option value="anime">Anime</option>
                <option value="crime">Crime</option>
                <option value="horror">Horror</option>
                <option value="romance">Romance</option>
             </select>
             <br>
             <br>
             <button type="submit" id="check">Check</button>
            <button type="button" id="next-btn">Next Results</button>
        </form>
        {% if results %}
            <div id="results">
                {% if results is string %}
                    <p>{{ results }}</p>  <!-- fallback message from Python -->
                {% else %}
                    {% for movie in results %}
                        <div class="movie-card">
                        <img src="{{ movie.poster_url }}" alt="{{ movie.title }} poster">
                        <h3>{{ movie.title }} ({{ movie.release_date }})</h3>
                        <p>{{ movie.overview }}</p>
                        <br>
                        <hr>
                        </div>
                    {% endfor %}
                {% endif %}
            </div>
        {% endif %}
        </div>
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                const nextBtn = document.getElementById('next-btn');
                const checkBtn = document.getElementById('check');
                const pageInput = document.getElementById('page');
                const resultsExist = document.getElementById('results') !== null;

                // Show/hide button based on results and localStorage flag
                if (resultsExist && localStorage.getItem('showNextBtn') === 'true') {
                    nextBtn.style.display = 'inline-block';
                } else {
                    nextBtn.style.display = 'none';
                    localStorage.removeItem('showNextBtn'); // reset if no results
                }
                // When "Check" is clicked, set flag to show button next time
                checkBtn.addEventListener('click', function () {
                    localStorage.setItem('showNextBtn', 'true');
                });
                // When "Next Results" is clicked, increment page and submit
                nextBtn.addEventListener('click', function () {
                    pageInput.value = parseInt(pageInput.value) + 1;
                    document.querySelector('form').submit();
                });
            });
        </script>
    </body>
</html>